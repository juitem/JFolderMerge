sequenceDiagram
    participant User
    participant Frontend as Frontend (JS)
    participant Backend as Backend (FastAPI)
    participant FS as FileSystem

    %% Startup
    Note over User, FS: Application Startup
    User->>Frontend: Load Page
    Frontend->>Backend: GET /api/config
    Backend-->>Frontend: {left: "path/A", right: "path/B"}
    Frontend->>User: Display Default Paths

    %% Comparison
    Note over User, FS: Folder Comparison
    User->>Frontend: Click "Compare"
    Frontend->>Backend: POST /api/compare {left, right}
    Backend->>FS: os.walk / scandir
    FS-->>Backend: File List
    Backend->>Backend: Compare & Tag (Added/Removed/Mod)
    Backend-->>Frontend: JSON Tree Structure
    Frontend->>User: Render Tree View

    %% View File
    Note over User, FS: Viewing Diffs
    User->>Frontend: Select "modified.txt"
    Frontend->>Backend: GET /api/content?path=...
    Backend->>FS: Read File
    FS-->>Backend: Content
    Backend-->>Frontend: File Content
    Frontend->>Backend: POST /api/diff {mode: side-by-side}
    Backend-->>Frontend: Diff Lines JSON
    Frontend->>User: Render Diff View

    %% Merging
    Note over User, FS: Merging Lines
    User->>Frontend: Click Merge Arrow (â†’)
    Frontend->>Frontend: Update Right Line in Memory
    Frontend->>Backend: POST /api/save-file {path, content}
    Backend->>FS: Write File (Atomic)
    FS-->>Backend: Success
    Backend-->>Frontend: {status: "success"}
    Frontend->>Frontend: Re-fetch Diff (Refresh)
    Frontend->>User: Update View (Line Merged)
